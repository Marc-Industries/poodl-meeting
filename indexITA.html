<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Poodl ITA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
     
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f4f8;
            transition: background-color 0.3s ease;
        }
        .container {
            max-width: 400px;
            padding: 30px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        /* Colore per lo stato ATTIVO (verde) */
        .active-status { color: #10b981; } 
        
        /* Nuovo colore per lo stato UPCOMING (Viola/Magenta) */
        .upcoming-status { color: #5A3FA3; } 
        
        /* Gradiente personalizzato per il bottone in stato UPCOMING */
        .poodl-gradient {
            background: linear-gradient(90deg, #1f4287 0%, #a33f52 100%); /* Blu-Viola a Rosso-Magenta */
            transition: opacity 0.3s ease, transform 0.1s ease;
        }
        .poodl-gradient:hover {
            opacity: 0.9;
        }

        /* Stile per l'icona della lingua */
        .lang-switch {
            position: fixed; /* Fissa la posizione */
            top: 20px;
            left: 20px;
            font-size: 32px; /* Dimensione dell'emoji */
            cursor: pointer;
            transition: transform 0.2s ease;
            text-decoration: none;
            z-index: 10; /* Assicura che sia sopra tutto */
        }
        .lang-switch:hover {
            transform: scale(1.1);
        }

        .loading-icon, .status-icon { margin: 0 auto 15px; }
    </style>
</head>
<body>

<!-- Language Switch Icon (Bandiera Inglese) -->
<!-- 
    âš ï¸ IMPORTANTE: 
    Questo link reindirizza alla cartella /en/.
    Devi assicurarti di creare un file a questo percorso: /en/index.html 
-->
<div class="lang-switch" title="Programma in Italiano">ðŸ‡®ðŸ‡¹</div>

<div class="container">
    <!-- Icona di caricamento iniziale/status -->
    <div id="status-icon" class="loading-icon">
        <svg class="animate-spin h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    </div>

    <!-- Messaggio di stato principale -->
    <h3 id="status-title" class="text-xl font-bold text-gray-800">Verifica lo stato della call...</h3>
    
    <!-- Dettagli (Orario, Link di fallback) -->
    <p id="status-details" class="text-md text-gray-600 mt-2">Attendere prego.</p>
    
    <!-- Bottone dinamico: mostra il link attivo O il link di info -->
    <a id="dynamic-button" class="mt-6 inline-block text-white font-bold py-3 px-6 rounded-xl transition duration-150 ease-in-out shadow-lg opacity-0 pointer-events-none" href="#"></a>
</div>

<script>
    // --------------------------------------------------------
    // CONFIGURAZIONE: DEFINIZIONE ORARI E LINK
    // --------------------------------------------------------
    // Struttura: day (0=Dom, 1=Lun, ..., 6=Sab), startHour (0-23), endHour (0-23), link, description
    // TUTTE LE CALL SONO DI 1 ORA.
    
    const SCHEDULE = [
        // MartedÃ¬ (2)
        { day: 2, startHour: 14, endHour: 15, link: "https://us06web.zoom.us/j/88431190609?pwd=0xYBcVRT3aMHkblFpKGvd617JJW7Av.1", description: "Call MartedÃ¬ Pomeriggio (14:00 - 15:00)" },
        { day: 2, startHour: 21, endHour: 22, link: "https://us06web.zoom.us/j/83251838167?pwd=1WBY1Oa5H0YXMeP6oledJ9BnJGLkAx.1", description: "Call MartedÃ¬ Serale (21:00 - 22:00)" },
        
        // MercoledÃ¬ (3)
        { day: 3, startHour: 14, endHour: 15, link: "https://us06web.zoom.us/j/89155346246?pwd=iTXDLkkjbLtX46GpMP26vv0MlQfP2x.1", description: "Call MercoledÃ¬ Pomeriggio (14:00 - 15:00)" },
        { day: 3, startHour: 20, endHour: 21, link: "https://us06web.zoom.us/j/86913335217?pwd=YEjFoRXA2EnD6nFPaWLgQuEXYyCUPa.1", description: "Call MercoledÃ¬ Sera (20:00 - 21:00)" },
        
        // GiovedÃ¬ (4)
        { day: 4, startHour: 14, endHour: 15, link: "https://us06web.zoom.us/j/83737475239?pwd=a3ra74dsr2I32AsOeH6X3AOs3E3zUe.1", description: "Call GiovedÃ¬ Pomeriggio (14:00 - 15:00)" },
        
        // VenerdÃ¬ (5)
        { day: 5, startHour: 11, endHour: 12, link: "https://us06web.zoom.us/j/89410434194?pwd=Skjpwr30M0nfhdIngtnl35DsBYeczA.1", description: "Call VenerdÃ¬ Mattina (11:00 - 12:00)" },
        { day: 5, startHour: 19, endHour: 20, link: "https://us06web.zoom.us/j/84274225106?pwd=2hFIR1lDKNCntqfRoBnebVCtSXrNyN.1", description: "Call VenerdÃ¬ Sera (19:00 - 20:00)" },
        
        // LunedÃ¬ (1), Sabato (6) e Domenica (0) sono esclusi dalla programmazione e attivano lo stato NONE/FALLBACK.
    ].sort((a, b) => a.day - b.day || a.startHour - b.startHour); 
    
    // Link di default quando non ci sono call attive o in programma.
    const FALLBACK_URL = "https://marc-industries.github.io/poodl-meeting/schedule_ita.html"; 

    // --------------------------------------------------------
    // FUNZIONI DI LOGICA
    // --------------------------------------------------------

    /**
     * Calcola lo stato attuale (Attiva, Prossima, o Non Attiva).
     */
    function getCallStatus() {
        const now = new Date();
        const currentDay = now.getDay(); 
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        
        // 1. Cerca la CALL ATTIVA OGGI (Redirect Immediato)
        for (const call of SCHEDULE) {
            // Se Ã¨ il giorno giusto
            if (call.day === currentDay) {
                // Calcola l'orario di inizio e fine in minuti per una comparazione piÃ¹ precisa
                const startMinutes = call.startHour * 60;
                const endMinutes = call.endHour * 60;
                const nowMinutes = currentHour * 60 + currentMinute;

                // Verifica che l'ora corrente (con i minuti) sia compresa tra inizio e fine call
                if (nowMinutes >= startMinutes && nowMinutes < endMinutes) {
                    return { status: 'ACTIVE', call: call }; // Trovata call attiva
                }
            }
        }

        // 2. Cerca la PROSSIMA CALL (Oggi o nei giorni seguenti)
        
        for (let i = 0; i < 7; i++) {
            const checkDay = (currentDay + i) % 7; // Giorno da 0 a 6
            
            // Filtra la SCHEDULE per il giorno corrente e ordina per ora
            const callsForDay = SCHEDULE.filter(call => call.day === checkDay);

            for (const call of callsForDay) {
                const nextCallTime = new Date(now);
                
                // Aggiusta la data se la call Ã¨ in un giorno futuro (i > 0)
                if (i > 0) {
                     nextCallTime.setDate(now.getDate() + i);
                }
                
                nextCallTime.setHours(call.startHour, 0, 0, 0); // Imposta l'ora di inizio
                
                // Se la call Ã¨ OGGI, verifica che non sia giÃ  passata l'ora
                if (i === 0 && now.getTime() < nextCallTime.getTime()) {
                     return { status: 'UPCOMING', call: call, nextCallTime: nextCallTime };
                } 
                // Se la call Ã¨ in un giorno FUTURO (i > 0)
                else if (i > 0) {
                    return { status: 'UPCOMING', call: call, nextCallTime: nextCallTime };
                }
            }
        }

        // 3. Nessuna call trovata (Dovrebbe accadere solo se tutte le call sono passate per la settimana)
        return { status: 'NONE' };
    }

    /**
     * Aggiorna la UI in base allo stato.
     */
    function updateUI(statusResult) {
        const titleElement = document.getElementById('status-title');
        const detailsElement = document.getElementById('status-details');
        const buttonElement = document.getElementById('dynamic-button');
        const iconElement = document.getElementById('status-icon');

        // Nasconde l'icona di caricamento rotante
        iconElement.innerHTML = ''; 
        // Rimuove classi dinamiche predefinite per applicare il nuovo stile Poodl
        buttonElement.classList.remove('bg-indigo-500', 'hover:bg-indigo-600', 'bg-amber-500', 'hover:bg-amber-600', 'bg-blue-500', 'hover:bg-blue-600');

        buttonElement.classList.add('opacity-100', 'pointer-events-auto');

        switch (statusResult.status) {
            case 'ACTIVE':
                // CASO 1: CALL ATTIVA (Verde)
                titleElement.textContent = "Sei In Diretta Ora!";
                titleElement.classList.add('active-status');
                detailsElement.textContent = `La call Ã¨ attiva adesso: ${statusResult.call.description}. Verrai reindirizzato.`;
                
                // Aggiorna l'icona con un check verde
                iconElement.innerHTML = '<svg class="w-8 h-8 active-status" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
                
                // Aggiorna il bottone (Usa il gradiente Poodl anche per Active, Ã¨ piÃ¹ coerente)
                buttonElement.textContent = "Clicca qui per Entrare";
                buttonElement.href = statusResult.call.link;
                buttonElement.classList.add('poodl-gradient');


                // Esegue il redirect dopo un breve ritardo per feedback visivo
                setTimeout(() => {
                    window.location.replace(statusResult.call.link);
                }, 1500);
                break;

            case 'UPCOMING':
                // CASO 2: CALL IN ARRIVO (Colore personalizzato #5A3FA3)
                const nextTime = statusResult.nextCallTime;
                
                // Formatta l'orario e il giorno in italiano
                const dateOptions = { weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit' };
                const formattedTime = nextTime.toLocaleTimeString('it-IT', dateOptions);

                titleElement.textContent = "Non siamo in diretta adesso.";
                titleElement.classList.remove('text-gray-800'); // Rimuove il testo grigio di default
                titleElement.classList.add('upcoming-status'); // Applica il colore viola/magenta

                detailsElement.innerHTML = `La prossima call Ã¨ in programma per:<br><strong class="font-bold">${formattedTime}</strong><br>(${statusResult.call.description})`;
                detailsElement.classList.remove('text-gray-600');
                detailsElement.classList.add('text-gray-700', 'font-medium');

                // Aggiorna l'icona con l'orologio nel nuovo colore
                iconElement.innerHTML = '<svg class="w-8 h-8 upcoming-status" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';

                // Aggiorna il bottone con il link di fallback informativo e il gradiente
                buttonElement.textContent = "Vedi Programmazione";
                buttonElement.href = FALLBACK_URL;
                buttonElement.classList.add('poodl-gradient');

                break;
            
            case 'NONE':
            default:
                // CASO 3: NESSUNA CALL ATTIVA O PROSSIMA (Fallback assoluto)
                titleElement.textContent = "Nessuna Call in Programma";
                detailsElement.textContent = "Non ci sono call Zoom in diretta o previste per i prossimi giorni. Consulta la programmazione.";
                
                // Aggiorna l'icona con un'informazione (usiamo il gradiente Poodl per consistenza)
                iconElement.innerHTML = '<svg class="w-8 h-8 upcoming-status" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>';
                
                // Aggiorna il bottone con il link di fallback informativo e il gradiente
                buttonElement.textContent = "Vedi la Programmazione Completa";
                buttonElement.href = FALLBACK_URL;
                buttonElement.classList.add('poodl-gradient');
                break;
        }
    }

    // --------------------------------------------------------
    // AVVIO
    // --------------------------------------------------------

    const status = getCallStatus();
    updateUI(status);
</script>

</body>
</html>
